<%- include('./partials/header') %>

<h1><%= title %></h1>

<form action="" method="post">
    <label for="title">Title: </label>
    <input type="text" id="title" name="title" required value="<%= book ? book.title : '' %>">
    
    <label for="author">Author: </label>
    <select name="author" id="author" required>
        <option value="">--Please select an Author--</option>
        <% if (authors) { %>
            <% authors.forEach(author => { %>
                <% if (book) { %>
                    <%if(author._id.toString() === book.author._id.toString()) { %>
                        <option value="<%= author._id %>" selected><%= author.name %></option>
                    <% } else { %>
                    <option value="<%= author._id %>"><%= author.name %></option>
                    <% } %>
                <% } else { %>    
                    <option value="<%= author._id %>"><%= author.name %></option>
                <% } %>
            <% }) %>
        <% } %>

    </select>
    
    <label for="summary">Summary: </label>
    <textarea name="summary" id="summary" cols="30" rows="10" required><%= book ? book.summary : '' %></textarea>
    
    <label for="isbn">ISBN: </label>
    <input type="text" id="isbn" name="isbn" required value="<%= book ? book.isbn : '' %>">
    
    <label>Genres: </label>
    <% if (genres) { %>
        <% genres.forEach(genre => { %>
            <% if (genre.checked) { %>
                <input type="checkbox" name="genre" value="<%= genre._id %>" checked/>
            <% } else { %>
                <input type="checkbox" name="genre" value="<%= genre._id %>"/>
            <% } %>
            <label for="<%= genre._id %>"><%= genre.name %></label>
        <% }) %>
    <% } else { %>
        <p>No genres availale.</p>
    <% } %>
    <button type="submit">Submit</button>
</form>
<% if (locals.errors) { %>
    <ul>
        <% errors.forEach(err => { %>
            <li><%= err.msg %></li>
        <% }) %>
    </ul>
<% } %>
<%- include('./partials/footer') %>
